<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registro de Embolses de Pl√°tano</title>
</head>
<body>
  <div id="root"></div>

  <!-- React + ReactDOM (UMD) y Babel para JSX inline -->
  <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    function App() {
      const [usuarioActual, setUsuarioActual] = React.useState(null);
      const [usuarios, setUsuarios] = React.useState([
        { id: 1, username: 'admin', password: 'admin123', rol: 'admin', nombre: 'Administrador' },
        { id: 2, username: 'usuario', password: 'user123', rol: 'usuario', nombre: 'Usuario Normal' }
      ]);
      const [registros, setRegistros] = React.useState([]);
      const [colores, setColores] = React.useState([
        { nombre: 'Rojo', hex: '#FF0000' },
        { nombre: 'Azul', hex: '#0000FF' },
        { nombre: 'Verde', hex: '#00FF00' },
        { nombre: 'Amarillo', hex: '#FFFF00' },
        { nombre: 'Naranja', hex: '#FFA500' },
        { nombre: 'Morado', hex: '#800080' },
        { nombre: 'Rosa', hex: '#FF69B4' },
        { nombre: 'Blanco', hex: '#FFFFFF' },
        { nombre: 'Negro', hex: '#000000' },
        { nombre: 'Caf√©', hex: '#8B4513' },
      ]);

      // Estados del formulario de login
      const [loginUsername, setLoginUsername] = React.useState('');
      const [loginPassword, setLoginPassword] = React.useState('');

      // Estados del formulario de registro
      const [nombreParcela, setNombreParcela] = React.useState('');
      const [colorSeleccionado, setColorSeleccionado] = React.useState('Rojo');
      const [hexSeleccionado, setHexSeleccionado] = React.useState('#FF0000');
      const [cantidad, setCantidad] = React.useState('');
      const [fecha, setFecha] = React.useState('');

      // Estados para gesti√≥n de usuarios (admin)
      const [mostrarGestionUsuarios, setMostrarGestionUsuarios] = React.useState(false);
      const [nuevoUsername, setNuevoUsername] = React.useState('');
      const [nuevoPassword, setNuevoPassword] = React.useState('');
      const [nuevoNombre, setNuevoNombre] = React.useState('');
      const [nuevoRol, setNuevoRol] = React.useState('usuario');

      // Estados para agregar colores
      const [mostrarAgregarColor, setMostrarAgregarColor] = React.useState(false);
      const [nuevoColorNombre, setNuevoColorNombre] = React.useState('');
      const [nuevoColorHex, setNuevoColorHex] = React.useState('#000000');

      // Estado para edici√≥n
      const [registroEditando, setRegistroEditando] = React.useState(null);

      // Manejo de login
      const handleLogin = () => {
        const usuario = usuarios.find(u => u.username === loginUsername && u.password === loginPassword);
        if (usuario) {
          setUsuarioActual(usuario);
          setLoginUsername('');
          setLoginPassword('');
          alert('Bienvenido ' + usuario.nombre);
        } else {
          alert('Usuario o contrase√±a incorrectos');
        }
      };

      const handleLogout = () => {
        setUsuarioActual(null);
        setMostrarGestionUsuarios(false);
        setMostrarAgregarColor(false);
      };

      // Guardar nuevo registro o actualizar existente
      const handleGuardar = () => {
        if (nombreParcela.trim() === '') {
          alert('Por favor ingresa el nombre de la parcela');
          return;
        }
        if (cantidad === '' || parseInt(cantidad) <= 0) {
          alert('Por favor ingresa una cantidad v√°lida de embolses');
          return;
        }
        if (fecha === '') {
          alert('Por favor selecciona la fecha del embolse');
          return;
        }

        if (registroEditando) {
          setRegistros(registros.map(r =>
            r.id === registroEditando.id
              ? { ...r, parcela: nombreParcela, cinta: colorSeleccionado, colorHex: hexSeleccionado, cantidad: parseInt(cantidad), fecha: fecha }
              : r
          ));
          setRegistroEditando(null);
          alert('Registro actualizado exitosamente!');
        } else {
          const nuevoRegistro = {
            id: Date.now(),
            parcela: nombreParcela,
            cinta: colorSeleccionado,
            colorHex: hexSeleccionado,
            cantidad: parseInt(cantidad),
            fecha: fecha,
            usuario: usuarioActual ? usuarioActual.nombre : 'N/A'
          };
          setRegistros([...registros, nuevoRegistro]);
          alert('Registro guardado exitosamente!');
        }

        setNombreParcela('');
        setCantidad('');
        setFecha('');
      };

      const handleEditar = (registro) => {
        setRegistroEditando(registro);
        setNombreParcela(registro.parcela);
        setColorSeleccionado(registro.cinta);
        setHexSeleccionado(registro.colorHex);
        setCantidad(registro.cantidad.toString());
        setFecha(registro.fecha);
        window.scrollTo({ top: 0, behavior: 'smooth' });
      };

      const handleCancelarEdicion = () => {
        setRegistroEditando(null);
        setNombreParcela('');
        setCantidad('');
        setFecha('');
      };

      const handleEliminar = (id) => {
        if (confirm('¬øEst√°s seguro de eliminar este registro?')) {
          setRegistros(registros.filter(r => r.id !== id));
        }
      };

      const handleColorClick = (color) => {
        setColorSeleccionado(color.nombre);
        setHexSeleccionado(color.hex);
      };

      // Usuarios admin
      const handleCrearUsuario = () => {
        if (nuevoUsername.trim() === '' || nuevoPassword.trim() === '' || nuevoNombre.trim() === '') {
          alert('Por favor completa todos los campos');
          return;
        }

        if (usuarios.find(u => u.username === nuevoUsername)) {
          alert('El nombre de usuario ya existe');
          return;
        }

        const nuevoUsuario = {
          id: Date.now(),
          username: nuevoUsername,
          password: nuevoPassword,
          rol: nuevoRol,
          nombre: nuevoNombre
        };

        setUsuarios([...usuarios, nuevoUsuario]);
        setNuevoUsername('');
        setNuevoPassword('');
        setNuevoNombre('');
        setNuevoRol('usuario');
        alert('Usuario creado exitosamente!');
      };

      const handleEliminarUsuario = (id) => {
        if (id === 1) {
          alert('No puedes eliminar el usuario administrador principal');
          return;
        }
        if (confirm('¬øEst√°s seguro de eliminar este usuario?')) {
          setUsuarios(usuarios.filter(u => u.id !== id));
        }
      };

      // Colores
      const handleAgregarColor = () => {
        if (nuevoColorNombre.trim() === '') {
          alert('Por favor ingresa el nombre del color');
          return;
        }

        if (colores.find(c => c.nombre.toLowerCase() === nuevoColorNombre.toLowerCase())) {
          alert('Ya existe un color con ese nombre');
          return;
        }

        const nuevoColor = {
          nombre: nuevoColorNombre,
          hex: nuevoColorHex
        };

        setColores([...colores, nuevoColor]);
        setNuevoColorNombre('');
        setNuevoColorHex('#000000');
        alert('Color agregado exitosamente!');
      };

      const handleEliminarColor = (nombreColor) => {
        if (colores.length <= 1) {
          alert('Debe haber al menos un color disponible');
          return;
        }
        if (confirm('¬øEst√°s seguro de eliminar este color?')) {
          setColores(colores.filter(c => c.nombre !== nombreColor));
        }
      };

      // Descargar CSV por fecha
      const descargarExcelPorFecha = (fechaRegistro) => {
        try {
          const registrosFecha = registros.filter(r => r.fecha === fechaRegistro);

          if (registrosFecha.length === 0) {
            alert('No hay registros para esta fecha');
            return;
          }

          const totalEmbolses = registrosFecha.reduce((sum, r) => sum + r.cantidad, 0);
          const fechaObj = new Date(fechaRegistro + 'T00:00:00');
          const fechaFormato = fechaObj.getDate() + '-' + (fechaObj.getMonth() + 1) + '-' + fechaObj.getFullYear();

          // Crear contenido CSV con BOM para evitar problemas de codificaci√≥n en Excel
          let csv = '\uFEFF'; // BOM para UTF-8
          csv += 'REGISTRO DE EMBOLSES - ' + fechaFormato + '\n\n';
          csv += 'Parcela,Color de Cinta,Cantidad,Registrado por\n';

          registrosFecha.forEach(reg => {
            // Escapar comillas
            const parcela = String(reg.parcela || '').replace(/"/g, '""');
            const cinta = String(reg.cinta || '').replace(/"/g, '""');
            const usuario = String(reg.usuario || 'N/A').replace(/"/g, '""');
            csv += '"' + parcela + '","' + cinta + '","' + reg.cantidad + '","' + usuario + '"\n';
          });

          csv += '\n';
          csv += 'TOTAL DE EMBOLSES:,' + totalEmbolses + '\n';

          // Crear y descargar archivo
          const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
          const url = window.URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.setAttribute('href', url);
          link.setAttribute('download', 'embolses_' + fechaRegistro + '.csv');
          link.style.visibility = 'hidden';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          window.URL.revokeObjectURL(url);

          alert('¬°Archivo descargado! Abre el archivo CSV con Excel o Google Sheets.');
        } catch (error) {
          alert('Error al descargar: ' + error.message);
          console.error('Error:', error);
        }
      };

      // Calcular resumen por parcela y color
      const resumen = {};
      registros.forEach(r => {
        const clave = r.parcela + '|' + r.cinta;
        if (!resumen[clave]) {
          resumen[clave] = {
            parcela: r.parcela,
            cinta: r.cinta,
            colorHex: r.colorHex,
            total: 0
          };
        }
        resumen[clave].total += r.cantidad;
      });
      const resumenArray = Object.values(resumen);
      const totalEmbolses = registros.reduce((sum, r) => sum + r.cantidad, 0);

      // Agrupar registros por fecha
      const registrosPorFecha = {};
      registros.forEach(r => {
        if (!registrosPorFecha[r.fecha]) {
          registrosPorFecha[r.fecha] = [];
        }
        registrosPorFecha[r.fecha].push(r);
      });

      // Ordenar fechas de m√°s reciente a m√°s antigua
      const fechasOrdenadas = Object.keys(registrosPorFecha).sort((a, b) => new Date(b) - new Date(a));

      // Pantalla de Login
      if (!usuarioActual) {
        return (
          <div style={{ minHeight: '100vh', backgroundColor: '#f0fdf4', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '20px' }}>
            <div style={{ backgroundColor: 'white', padding: '40px', borderRadius: '10px', boxShadow: '0 4px 6px rgba(0,0,0,0.1)', maxWidth: '400px', width: '100%' }}>
              <h1 style={{ fontSize: '28px', fontWeight: 'bold', marginBottom: '10px', color: '#16a34a', textAlign: 'center' }}>üçå Sistema de Embolses</h1>
              <p style={{ textAlign: 'center', color: '#666', marginBottom: '30px' }}>Iniciar Sesi√≥n</p>

              <div style={{ marginBottom: '20px' }}>
                <label style={{ display: 'block', fontSize: '14px', fontWeight: 'bold', marginBottom: '8px' }}>Usuario:</label>
                <input
                  type="text"
                  value={loginUsername}
                  onChange={(e) => setLoginUsername(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                  placeholder="Ingresa tu usuario"
                  style={{ width: '100%', padding: '12px', fontSize: '16px', border: '2px solid #16a34a', borderRadius: '8px', boxSizing: 'border-box' }}
                />
              </div>

              <div style={{ marginBottom: '30px' }}>
                <label style={{ display: 'block', fontSize: '14px', fontWeight: 'bold', marginBottom: '8px' }}>Contrase√±a:</label>
                <input
                  type="password"
                  value={loginPassword}
                  onChange={(e) => setLoginPassword(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                  placeholder="Ingresa tu contrase√±a"
                  style={{ width: '100%', padding: '12px', fontSize: '16px', border: '2px solid #16a34a', borderRadius: '8px', boxSizing: 'border-box' }}
                />
              </div>

              <button
                onClick={handleLogin}
                style={{ width: '100%', backgroundColor: '#16a34a', color: 'white', padding: '15px', fontSize: '18px', fontWeight: 'bold', border: 'none', borderRadius: '8px', cursor: 'pointer' }}
              >
                Iniciar Sesi√≥n
              </button>

              <div style={{ marginTop: '30px', padding: '15px', backgroundColor: '#f0f0f0', borderRadius: '8px', fontSize: '12px' }}>
                <p style={{ margin: '0 0 5px 0', fontWeight: 'bold' }}>Usuarios de prueba:</p>
                <p style={{ margin: '5px 0' }}>Admin: usuario: <strong>admin</strong> / contrase√±a: <strong>admin123</strong></p>
                <p style={{ margin: '5px 0' }}>Usuario: usuario: <strong>usuario</strong> / contrase√±a: <strong>user123</strong></p>
              </div>
            </div>
          </div>
        );
      }

      // Pantalla principal (usuario logueado)
      return (
        <div style={{ minHeight: '100vh', backgroundColor: '#f0fdf4', padding: '20px' }}>
          <div style={{ maxWidth: '1200px', margin: '0 auto' }}>

            {/* Header */}
            <div style={{ backgroundColor: '#16a34a', color: 'white', padding: '30px', borderRadius: '10px', marginBottom: '20px' }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '10px' }}>
                <div>
                  <h1 style={{ fontSize: '32px', fontWeight: 'bold', margin: '0' }}>üçå Registro de Embolses</h1>
                  <p style={{ margin: '10px 0 0 0', fontSize: '16px' }}>
                    Usuario: <strong>{usuarioActual.nombre}</strong> ({usuarioActual.rol === 'admin' ? 'Administrador' : 'Usuario'})
                  </p>
                  <p style={{ margin: '5px 0 0 0', fontSize: '16px' }}>
                    Total de registros: {registros.length} | Total de embolses: {totalEmbolses}
                  </p>
                </div>
                <div style={{ display: 'flex', gap: '10px', flexWrap: 'wrap' }}>
                  {usuarioActual.rol === 'admin' && (
                    <>
                      <button
                        onClick={() => setMostrarGestionUsuarios(!mostrarGestionUsuarios)}
                        style={{ backgroundColor: '#2563eb', color: 'white', padding: '10px 20px', fontSize: '14px', fontWeight: 'bold', border: 'none', borderRadius: '8px', cursor: 'pointer' }}
                      >
                        üë• Gestionar Usuarios
                      </button>
                      <button
                        onClick={() => setMostrarAgregarColor(!mostrarAgregarColor)}
                        style={{ backgroundColor: '#7c3aed', color: 'white', padding: '10px 20px', fontSize: '14px', fontWeight: 'bold', border: 'none', borderRadius: '8px', cursor: 'pointer' }}
                      >
                        üé® Gestionar Colores
                      </button>
                    </>
                  )}
                  <button
                    onClick={handleLogout}
                    style={{ backgroundColor: '#dc2626', color: 'white', padding: '10px 20px', fontSize: '14px', fontWeight: 'bold', border: 'none', borderRadius: '8px', cursor: 'pointer' }}
                  >
                    Cerrar Sesi√≥n
                  </button>
                </div>
              </div>
            </div>

            {/* Gesti√≥n de Usuarios (solo admin) */}
            {usuarioActual.rol === 'admin' && mostrarGestionUsuarios && (
              <div style={{ backgroundColor: 'white', padding: '30px', borderRadius: '10px', marginBottom: '20px', boxShadow: '0 4px 6px rgba(0,0,0,0.1)' }}>
                <h2 style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '20px', color: '#2563eb' }}>üë• Gesti√≥n de Usuarios</h2>

                <div style={{ marginBottom: '30px', padding: '20px', backgroundColor: '#eff6ff', borderRadius: '8px' }}>
                  <h3 style={{ fontSize: '18px', fontWeight: 'bold', marginBottom: '15px' }}>Crear Nuevo Usuario</h3>
                  <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px', marginBottom: '15px' }}>
                    <div>
                      <label style={{ display: 'block', fontSize: '14px', fontWeight: 'bold', marginBottom: '5px' }}>Nombre Completo:</label>
                      <input
                        type="text"
                        value={nuevoNombre}
                        onChange={(e) => setNuevoNombre(e.target.value)}
                        placeholder="Ej: Juan P√©rez"
                        style={{ width: '100%', padding: '10px', fontSize: '14px', border: '2px solid #2563eb', borderRadius: '6px', boxSizing: 'border-box' }}
                      />
                    </div>
                    <div>
                      <label style={{ display: 'block', fontSize: '14px', fontWeight: 'bold', marginBottom: '5px' }}>Usuario:</label>
                      <input
                        type="text"
                        value={nuevoUsername}
                        onChange={(e) => setNuevoUsername(e.target.value)}
                        placeholder="Ej: jperez"
                        style={{ width: '100%', padding: '10px', fontSize: '14px', border: '2px solid #2563eb', borderRadius: '6px', boxSizing: 'border-box' }}
                      />
                    </div>
                    <div>
                      <label style={{ display: 'block', fontSize: '14px', fontWeight: 'bold', marginBottom: '5px' }}>Contrase√±a:</label>
                      <input
                        type="text"
                        value={nuevoPassword}
                        onChange={(e) => setNuevoPassword(e.target.value)}
                        placeholder="Contrase√±a"
                        style={{ width: '100%', padding: '10px', fontSize: '14px', border: '2px solid #2563eb', borderRadius: '6px', boxSizing: 'border-box' }}
                      />
                    </div>
                    <div>
                      <label style={{ display: 'block', fontSize: '14px', fontWeight: 'bold', marginBottom: '5px' }}>Rol:</label>
                      <select
                        value={nuevoRol}
                        onChange={(e) => setNuevoRol(e.target.value)}
                        style={{ width: '100%', padding: '10px', fontSize: '14px', border: '2px solid #2563eb', borderRadius: '6px', boxSizing: 'border-box' }}
                      >
                        <option value="usuario">Usuario Normal</option>
                        <option value="admin">Administrador</option>
                      </select>
                    </div>
                  </div>
                  <button
                    onClick={handleCrearUsuario}
                    style={{ backgroundColor: '#2563eb', color: 'white', padding: '10px 20px', fontSize: '14px', fontWeight: 'bold', border: 'none', borderRadius: '6px', cursor: 'pointer' }}
                  >
                    Crear Usuario
                  </button>
                </div>

                <h3 style={{ fontSize: '18px', fontWeight: 'bold', marginBottom: '15px' }}>Usuarios Registrados</h3>
                <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                  <thead>
                    <tr style={{ backgroundColor: '#2563eb', color: 'white' }}>
                      <th style={{ padding: '12px', textAlign: 'left', border: '1px solid #ddd' }}>Nombre</th>
                      <th style={{ padding: '12px', textAlign: 'left', border: '1px solid #ddd' }}>Usuario</th>
                      <th style={{ padding: '12px', textAlign: 'left', border: '1px solid #ddd' }}>Rol</th>
                      <th style={{ padding: '12px', textAlign: 'center', border: '1px solid #ddd' }}>Acci√≥n</th>
                    </tr>
                  </thead>
                  <tbody>
                    {usuarios.map((user, idx) => (
                      <tr key={user.id} style={{ backgroundColor: idx % 2 === 0 ? '#f9fafb' : 'white' }}>
                        <td style={{ padding: '12px', border: '1px solid #ddd' }}>{user.nombre}</td>
                        <td style={{ padding: '12px', border: '1px solid #ddd' }}>{user.username}</td>
                        <td style={{ padding: '12px', border: '1px solid #ddd' }}>
                          <span style={{
                            padding: '4px 12px',
                            borderRadius: '12px',
                            fontSize: '12px',
                            fontWeight: 'bold',
                            backgroundColor: user.rol === 'admin' ? '#fef3c7' : '#dbeafe',
                            color: user.rol === 'admin' ? '#92400e' : '#1e40af'
                          }}>
                            {user.rol === 'admin' ? 'Administrador' : 'Usuario'}
                          </span>
                        </td>
                        <td style={{ padding: '12px', border: '1px solid #ddd', textAlign: 'center' }}>
                          {user.id !== 1 && (
                            <button
                              onClick={() => handleEliminarUsuario(user.id)}
                              style={{ backgroundColor: '#dc2626', color: 'white', padding: '6px 12px', border: 'none', borderRadius: '4px', cursor: 'pointer', fontSize: '12px', fontWeight: 'bold' }}
                            >
                              Eliminar
                            </button>
                          )}
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}

            {/* Gesti√≥n de Colores (solo admin) */}
            {usuarioActual.rol === 'admin' && mostrarAgregarColor && (
              <div style={{ backgroundColor: 'white', padding: '30px', borderRadius: '10px', marginBottom: '20px', boxShadow: '0 4px 6px rgba(0,0,0,0.1)' }}>
                <h2 style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '20px', color: '#7c3aed' }}>üé® Gesti√≥n de Colores</h2>

                <div style={{ marginBottom: '30px', padding: '20px', backgroundColor: '#faf5ff', borderRadius: '8px' }}>
                  <h3 style={{ fontSize: '18px', fontWeight: 'bold', marginBottom: '15px' }}>Agregar Nuevo Color</h3>
                  <div style={{ display: 'grid', gridTemplateColumns: '2fr 1fr auto', gap: '15px', alignItems: 'end' }}>
                    <div>
                      <label style={{ display: 'block', fontSize: '14px', fontWeight: 'bold', marginBottom: '5px' }}>Nombre del Color:</label>
                      <input
                        type="text"
                        value={nuevoColorNombre}
                        onChange={(e) => setNuevoColorNombre(e.target.value)}
                        placeholder="Ej: Celeste"
                        style={{ width: '100%', padding: '10px', fontSize: '14px', border: '2px solid #7c3aed', borderRadius: '6px', boxSizing: 'border-box' }}
                      />
                    </div>
                    <div>
                      <label style={{ display: 'block', fontSize: '14px', fontWeight: 'bold', marginBottom: '5px' }}>Color (Hex):</label>
                      <input
                        type="color"
                        value={nuevoColorHex}
                        onChange={(e) => setNuevoColorHex(e.target.value)}
                        style={{ width: '100%', height: '42px', padding: '2px', border: '2px solid #7c3aed', borderRadius: '6px', boxSizing: 'border-box', cursor: 'pointer' }}
                      />
                    </div>
                    <button
                      onClick={handleAgregarColor}
                      style={{ backgroundColor: '#7c3aed', color: 'white', padding: '10px 20px', fontSize: '14px', fontWeight: 'bold', border: 'none', borderRadius: '6px', cursor: 'pointer', height: '42px' }}
                    >
                      Agregar Color
                    </button>
                  </div>
                </div>

                <h3 style={{ fontSize: '18px', fontWeight: 'bold', marginBottom: '15px' }}>Colores Disponibles ({colores.length})</h3>
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(150px, 1fr))', gap: '15px' }}>
                  {colores.map((color, idx) => (
                    <div key={idx} style={{ padding: '15px', border: '2px solid #e5e7eb', borderRadius: '8px', textAlign: 'center', backgroundColor: '#f9fafb' }}>
                      <div style={{ width: '80px', height: '80px', backgroundColor: color.hex, borderRadius: '50%', border: '3px solid #666', margin: '0 auto 10px' }} />
                      <p style={{ fontWeight: 'bold', fontSize: '14px', margin: '5px 0' }}>{color.nombre}</p>
                      <p style={{ fontSize: '12px', color: '#666', margin: '5px 0' }}>{color.hex}</p>
                      <button
                        onClick={() => handleEliminarColor(color.nombre)}
                        style={{ backgroundColor: '#dc2626', color: 'white', padding: '6px 12px', border: 'none', borderRadius: '4px', cursor: 'pointer', fontSize: '11px', fontWeight: 'bold', marginTop: '8px' }}
                      >
                        Eliminar
                      </button>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* Formulario de Registro */}
            <div style={{ backgroundColor: 'white', padding: '30px', borderRadius: '10px', marginBottom: '20px', boxShadow: '0 4px 6px rgba(0,0,0,0.1)' }}>
              <h2 style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '20px', color: '#16a34a' }}>
                {registroEditando ? '‚úèÔ∏è Editar Registro' : 'Nuevo Registro'}
              </h2>

              <div style={{ marginBottom: '20px' }}>
                <label style={{ display: 'block', fontSize: '16px', fontWeight: 'bold', marginBottom: '8px' }}>Nombre de la Parcela:</label>
                <input
                  type="text"
                  value={nombreParcela}
                  onChange={(e) => setNombreParcela(e.target.value)}
                  placeholder="Ej: Parcela A"
                  style={{ width: '100%', padding: '12px', fontSize: '16px', border: '2px solid #16a34a', borderRadius: '8px', boxSizing: 'border-box' }}
                />
              </div>

              <div style={{ marginBottom: '20px' }}>
                <label style={{ display: 'block', fontSize: '16px', fontWeight: 'bold', marginBottom: '8px' }}>
                  Color de Cinta: <span style={{ color: '#16a34a' }}>{colorSeleccionado}</span>
                </label>
                <div style={{ display: 'flex', gap: '10px', flexWrap: 'wrap' }}>
                  {colores.map(color => (
                    <button
                      key={color.nombre}
                      onClick={() => handleColorClick(color)}
                      style={{
                        padding: '10px',
                        border: colorSeleccionado === color.nombre ? '4px solid black' : '2px solid #ccc',
                        borderRadius: '8px',
                        backgroundColor: colorSeleccionado === color.nombre ? '#f0f0f0' : 'white',
                        cursor: 'pointer',
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'center',
                        gap: '5px'
                      }}
                    >
                      <div style={{ width: '50px', height: '50px', backgroundColor: color.hex, borderRadius: '50%', border: '2px solid #666' }} />
                      <span style={{ fontSize: '12px', fontWeight: 'bold' }}>{color.nombre}</span>
                    </button>
                  ))}
                </div>
              </div>

              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px', marginBottom: '20px' }}>
                <div>
                  <label style={{ display: 'block', fontSize: '16px', fontWeight: 'bold', marginBottom: '8px' }}>Cantidad de Embolses:</label>
                  <input
                    type="number"
                    value={cantidad}
                    onChange={(e) => setCantidad(e.target.value)}
                    placeholder="Ej: 150"
                    min="1"
                    style={{ width: '100%', padding: '12px', fontSize: '16px', border: '2px solid #16a34a', borderRadius: '8px', boxSizing: 'border-box' }}
                  />
                </div>
                <div>
                  <label style={{ display: 'block', fontSize: '16px', fontWeight: 'bold', marginBottom: '8px' }}>D√≠a del Embolse:</label>
                  <input
                    type="date"
                    value={fecha}
                    onChange={(e) => setFecha(e.target.value)}
                    style={{ width: '100%', padding: '12px', fontSize: '16px', border: '2px solid #16a34a', borderRadius: '8px', boxSizing: 'border-box' }}
                  />
                </div>
              </div>

              <div style={{ display: 'flex', gap: '10px' }}>
                <button
                  onClick={handleGuardar}
                  style={{ backgroundColor: '#16a34a', color: 'white', padding: '15px 30px', fontSize: '18px', fontWeight: 'bold', border: 'none', borderRadius: '8px', cursor: 'pointer' }}
                >
                  {registroEditando ? '‚úì Actualizar Registro' : '‚úì Guardar Registro'}
                </button>
                {registroEditando && (
                  <button
                    onClick={handleCancelarEdicion}
                    style={{ backgroundColor: '#6b7280', color: 'white', padding: '15px 30px', fontSize: '18px', fontWeight: 'bold', border: 'none', borderRadius: '8px', cursor: 'pointer' }}
                  >
                    Cancelar
                  </button>
                )}
              </div>
            </div>

            {/* Resumen */}
            <div style={{ backgroundColor: 'white', padding: '20px', borderRadius: '10px', marginBottom: '20px', boxShadow: '0 4px 6px rgba(0,0,0,0.05)' }}>
              <h3 style={{ margin: '0 0 10px 0', fontSize: '18px', fontWeight: 'bold' }}>Resumen por Parcela y Cinta</h3>
              {resumenArray.length === 0 ? (
                <p style={{ color: '#666' }}>No hay registros a√∫n.</p>
              ) : (
                <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                  <thead>
                    <tr style={{ backgroundColor: '#f3f4f6' }}>
                      <th style={{ padding: '10px', textAlign: 'left', border: '1px solid #e5e7eb' }}>Parcela</th>
                      <th style={{ padding: '10px', textAlign: 'left', border: '1px solid #e5e7eb' }}>Cinta</th>
                      <th style={{ padding: '10px', textAlign: 'left', border: '1px solid #e5e7eb' }}>Total</th>
                    </tr>
                  </thead>
                  <tbody>
                    {resumenArray.map((r, idx) => (
                      <tr key={idx} style={{ backgroundColor: idx % 2 === 0 ? '#ffffff' : '#f9fafb' }}>
                        <td style={{ padding: '10px', border: '1px solid #e5e7eb' }}>{r.parcela}</td>
                        <td style={{ padding: '10px', border: '1px solid #e5e7eb', display: 'flex', alignItems: 'center', gap: '8px' }}>
                          <div style={{ width: '18px', height: '18px', backgroundColor: r.colorHex, border: '1px solid #666', borderRadius: '4px' }} />
                          {r.cinta}
                        </td>
                        <td style={{ padding: '10px', border: '1px solid #e5e7eb' }}>{r.total}</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              )}
            </div>

            {/* Registros por fecha */}
            <div style={{ marginBottom: '50px' }}>
              {fechasOrdenadas.length === 0 ? (
                <div style={{ backgroundColor: 'white', padding: '20px', borderRadius: '10px' }}>
                  <p style={{ margin: 0, color: '#666' }}>No hay registros agregados todav√≠a.</p>
                </div>
              ) : (
                fechasOrdenadas.map(fechaKey => {
                  const items = registrosPorFecha[fechaKey].sort((a,b) => b.id - a.id);
                  const totalFecha = items.reduce((s, it) => s + it.cantidad, 0);
                  return (
                    <div key={fechaKey} style={{ backgroundColor: 'white', padding: '20px', borderRadius: '10px', marginBottom: '15px', boxShadow: '0 4px 6px rgba(0,0,0,0.03)' }}>
                      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px', gap: '10px', flexWrap: 'wrap' }}>
                        <div>
                          <h4 style={{ margin: 0, fontSize: '16px', fontWeight: 'bold' }}>{fechaKey}</h4>
                          <p style={{ margin: '6px 0 0 0', color: '#444' }}>Total d√≠a: <strong>{totalFecha}</strong> | Registros: {items.length}</p>
                        </div>
                        <div style={{ display: 'flex', gap: '8px', alignItems: 'center' }}>
                          <button
                            onClick={() => descargarExcelPorFecha(fechaKey)}
                            style={{ backgroundColor: '#059669', color: 'white', padding: '8px 12px', border: 'none', borderRadius: '8px', cursor: 'pointer', fontWeight: 'bold' }}
                          >
                            üì• Descargar CSV (d√≠a)
                          </button>
                        </div>
                      </div>

                      <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                        <thead>
                          <tr style={{ backgroundColor: '#f8fafc' }}>
                            <th style={{ padding: '10px', textAlign: 'left', border: '1px solid #e5e7eb' }}>Parcela</th>
                            <th style={{ padding: '10px', textAlign: 'left', border: '1px solid #e5e7eb' }}>Cinta</th>
                            <th style={{ padding: '10px', textAlign: 'right', border: '1px solid #e5e7eb' }}>Cantidad</th>
                            <th style={{ padding: '10px', textAlign: 'left', border: '1px solid #e5e7eb' }}>Registrado por</th>
                            <th style={{ padding: '10px', textAlign: 'center', border: '1px solid #e5e7eb' }}>Acciones</th>
                          </tr>
                        </thead>
                        <tbody>
                          {items.map((reg, idx) => (
                            <tr key={reg.id} style={{ backgroundColor: idx % 2 === 0 ? '#ffffff' : '#fbfbff' }}>
                              <td style={{ padding: '10px', border: '1px solid #e5e7eb' }}>{reg.parcela}</td>
                              <td style={{ padding: '10px', border: '1px solid #e5e7eb', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                <div style={{ width: '16px', height: '16px', backgroundColor: reg.colorHex || '#000', border: '1px solid #666', borderRadius: '3px' }} />
                                {reg.cinta}
                              </td>
                              <td style={{ padding: '10px', border: '1px solid #e5e7eb', textAlign: 'right' }}>{reg.cantidad}</td>
                              <td style={{ padding: '10px', border: '1px solid #e5e7eb' }}>{reg.usuario}</td>
                              <td style={{ padding: '10px', border: '1px solid #e5e7eb', textAlign: 'center' }}>
                                {(usuarioActual.rol === 'admin' || usuarioActual.nombre === reg.usuario) && (
                                  <>
                                    <button
                                      onClick={() => handleEditar(reg)}
                                      style={{ backgroundColor: '#2563eb', color: 'white', padding: '6px 10px', border: 'none', borderRadius: '6px', cursor: 'pointer', marginRight: '6px' }}
                                    >
                                      ‚úèÔ∏è Editar
                                    </button>
                                    <button
                                      onClick={() => handleEliminar(reg.id)}
                                      style={{ backgroundColor: '#dc2626', color: 'white', padding: '6px 10px', border: 'none', borderRadius: '6px', cursor: 'pointer' }}
                                    >
                                      üóëÔ∏è Eliminar
                                    </button>
                                  </>
                                )}
                              </td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  );
                })
              )}
            </div>

            <footer style={{ textAlign: 'center', color: '#666', padding: '20px 0' }}>
              <small>Aplicaci√≥n local ‚Äî Guarda el archivo y √°brelo con tu navegador. Usuarios de prueba: admin/admin123, usuario/user123</small>
            </footer>
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>